@page "/"
@using GitHubIssueManager.Maui.Services
@inject AuthenticationService AuthService
@inject RepositoryService RepositoryService

<PageTitle>GitHub Issue Manager</PageTitle>

<MudText Typo="Typo.h3" GutterBottom="true">GitHub Issue Manager</MudText>
<MudText Typo="Typo.subtitle1" Class="mb-4">Manage GitHub issues across multiple repositories with ease.</MudText>

@if (!AuthService.IsAuthenticated)
{
    <MudGrid>
        <MudItem xs="12" md="8">
            <MudAlert Severity="Severity.Info" Class="mb-4">
                <MudText Typo="Typo.h6">Welcome to GitHub Issue Manager!</MudText>
                <MudText>This application helps you manage GitHub issues across multiple repositories. To get started:</MudText>
                <ol class="mt-2">
                    <li>Configure your GitHub Personal Access Token in <MudLink Href="/settings">Settings</MudLink></li>
                    <li>Browse and add repositories to your watchlist</li>
                    <li>View and manage issues across all your watched repositories</li>
                </ol>
            </MudAlert>
            
            <MudCard Class="mb-4">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Features</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudGrid>
                        <MudItem xs="12" md="6">
                            <MudText Typo="Typo.h6" Class="d-flex align-center mb-2">
                                <MudIcon Icon="@Icons.Custom.Brands.GitHub" Class="mr-2" />
                                Repository Management
                            </MudText>
                            <ul>
                                <li>Browse and search GitHub repositories</li>
                                <li>Add repositories to your watchlist</li>
                                <li>View repository metadata and statistics</li>
                            </ul>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudText Typo="Typo.h6" Class="d-flex align-center mb-2">
                                <MudIcon Icon="@Icons.Material.Filled.BugReport" Class="mr-2" />
                                Issue Management
                            </MudText>
                            <ul>
                                <li>View all issues across watched repositories</li>
                                <li>Create new issues</li>
                                <li>Update existing issues</li>
                                <li>Filter and search issues</li>
                            </ul>
                        </MudItem>
                    </MudGrid>
                </MudCardContent>
            </MudCard>
        </MudItem>
        <MudItem xs="12" md="4">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Quick Start</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardActions Class="pa-4">
                    <MudStack Style="width: 100%">
                        <MudButton Variant="Variant.Filled" 
                                   Color="Color.Primary" 
                                   StartIcon="@Icons.Material.Filled.Settings"
                                   Href="/settings"
                                   FullWidth="true">
                            Configure GitHub Token
                        </MudButton>
                        <MudButton Variant="Variant.Outlined" 
                                   Color="Color.Primary" 
                                   StartIcon="@Icons.Material.Filled.FolderOpen"
                                   Href="/repositories"
                                   FullWidth="true">
                            Browse Repositories
                        </MudButton>
                    </MudStack>
                </MudCardActions>
            </MudCard>
        </MudItem>
    </MudGrid>
}
else
{
    <MudGrid>
        <MudItem xs="12" md="8">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Watched Repositories</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    @{
                        var watchedRepos = RepositoryService.GetWatchedRepositories().ToList();
                    }
                    @if (watchedRepos.Any())
                    {
                        <MudGrid>
                            @foreach (var repo in watchedRepos.Take(6))
                            {
                                <MudItem xs="12" md="6" Class="mb-3">
                                    <MudCard Outlined="true">
                                        <MudCardContent>
                                            <MudText Typo="Typo.h6" Class="mb-2">
                                                <MudLink Href="@repo.HtmlUrl" Target="_blank" Color="Color.Primary">
                                                    @repo.FullName
                                                </MudLink>
                                            </MudText>
                                            <MudText Typo="Typo.body2" Color="Color.Secondary" Class="mb-2">
                                                @repo.Description
                                            </MudText>
                                            <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                                                <MudText Typo="Typo.caption" Color="Color.Info">
                                                    <MudIcon Icon="@Icons.Material.Filled.ErrorOutline" Size="Size.Small" Class="mr-1" />
                                                    @repo.OpenIssuesCount issues
                                                </MudText>
                                                <MudButton Size="Size.Small" 
                                                          Variant="Variant.Outlined" 
                                                          Color="Color.Primary"
                                                          Href="@($"/issues/{repo.Owner.Login}/{repo.Name}")">
                                                    View Issues
                                                </MudButton>
                                            </MudStack>
                                        </MudCardContent>
                                    </MudCard>
                                </MudItem>
                            }
                        </MudGrid>
                        
                        <MudStack Row="true" Justify="Justify.Center" Class="mt-4">
                            <MudButton Variant="Variant.Outlined" 
                                      Color="Color.Primary" 
                                      Href="/repositories">
                                View All Repositories
                            </MudButton>
                        </MudStack>
                    }
                    else
                    {
                        <MudStack AlignItems="AlignItems.Center" Class="py-8">
                            <MudIcon Icon="@Icons.Material.Filled.FolderOpen" Size="Size.Large" Color="Color.Secondary" />
                            <MudText Typo="Typo.body1" Color="Color.Secondary" Class="mb-4">
                                No repositories in your watchlist yet.
                            </MudText>
                            <MudButton Variant="Variant.Filled" 
                                      Color="Color.Primary" 
                                      StartIcon="@Icons.Material.Filled.Add"
                                      Href="/repositories">
                                Add Repositories
                            </MudButton>
                        </MudStack>
                    }
                </MudCardContent>
            </MudCard>
        </MudItem>
        <MudItem xs="12" md="4">
            <MudCard Class="mb-4">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Quick Actions</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardActions Class="pa-4">
                    <MudStack Style="width: 100%">
                        <MudButton Variant="Variant.Outlined" 
                                   Color="Color.Primary" 
                                   StartIcon="@Icons.Material.Filled.FolderOpen"
                                   Href="/repositories"
                                   FullWidth="true">
                            Browse Repositories
                        </MudButton>
                        <MudButton Variant="Variant.Outlined" 
                                   Color="Color.Secondary" 
                                   StartIcon="@Icons.Material.Filled.Settings"
                                   Href="/settings"
                                   FullWidth="true">
                            Settings
                        </MudButton>
                    </MudStack>
                </MudCardActions>
            </MudCard>
            
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Statistics</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudGrid>
                        <MudItem xs="6" Class="text-center">
                            <MudText Typo="Typo.h4" Color="Color.Primary">
                                @RepositoryService.GetWatchedRepositories().Count()
                            </MudText>
                            <MudText Typo="Typo.caption" Color="Color.Secondary">
                                Watched Repos
                            </MudText>
                        </MudItem>
                        <MudItem xs="6" Class="text-center">
                            <MudText Typo="Typo.h4" Color="Color.Warning">
                                @RepositoryService.GetWatchedRepositories().Sum(r => r.OpenIssuesCount)
                            </MudText>
                            <MudText Typo="Typo.caption" Color="Color.Secondary">
                                Open Issues
                            </MudText>
                        </MudItem>
                    </MudGrid>
                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>
}
